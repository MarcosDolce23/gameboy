<!DOCTYPE html>
<html>

	<head>
		<title>Pollen Boy</title>
		<meta charset='UTF-8'>

		<link rel='stylesheet' href='css/index.css'>
		<link rel='shortcut icon' href='img/favicon.png' type='image/png'>
	</head>
	<body>

		<!-- Title -->
		<div class='titlewrap'>
			<p class='title'>Pollen Boy</p>
			<p class='description'>A Gameboy Emulator made in JavaScript</p>
		</div>

		<div class='gbgap'></div>

		<div class='outerwrap'>

			<!-- GameBoy div -->
			<div class='gbwrap'> 

				<div class='gbtop'>
					<div class='screenwrap'>

						<div class='screencontainer'>
							<canvas id='nanacanvas' class='screen' width='160' height='144'></canvas>
							<span id='nanastat' class='status_text'></span>
						</div>

						<div class='center_flex_div'>
							<img src='img/gb_logo.png' class='gb_logo' draggable='false'>
						</div>

					</div>
				</div>

				<div class='gbgap'></div>

				<div class='gbbottom'>
					<!-- File input -->
					<input id='nanafin' type='file' accept='.gb, .gbc, .bin, .rom' class='hide'>
					<label for='nanafin' class='filebutton' style='width:200px;'>Choose ROM</label>
					<br>

					<label id='nanapause' class='roundbutton'></label>

					<!--Step Button
					<label id='nanapause' class='filebutton'>Step</label> -->
				</div>

			</div>

			<!-- Scripts -->
			<script src='src/cpu.js'></script>
			<script src='src/ops.js'></script>
			<script src='src/mem.js'></script>
			<script src='src/ppu.js'></script>
			<script src='src/joypad.js'></script>

			<script src='src/main.js'></script>

			<!-- Front-script -->
			<script>
				//window.onload = function () {

					const nanaCanvas = document.getElementById ('nanacanvas');
					const nanaFin = document.getElementById ('nanafin');
					const nanaStat = document.getElementById ('nanastat');
					const nanaPause = document.getElementById ('nanapause');

					// Gameboy
					const gb = new Gameboy ();
					gb.AttachCanvas (nanaCanvas);

					// Palletes
					this.palletes = {
						// I made these but mfs dont like em ... (rightfully so)
						'mono': ['ffffff', 'bbbbbb', '666666', '000000'],
						'grey': ['A5A5A5', '7F7F7F', '4C4C4C', '333333'],
						'leafy': ['47E09B', '1CCE31', '559984', '20705E'],
						'crimson': ['E04545', 'B71745', '771100', '3D0E24'],
						'hardware': ['75BC64', '639E64', '42603F', '21382A'],
						'pastel': ['FFA8DC', 'FF60AA', 'CC53AB', 'A0468E'],

						// Other ppl's
						'yychr': ['dec69c', 'a55aff', '942994', '003973'], // w.atwiki.jp/yychr
						'choco': ['ffe4c2', 'dca456', 'a9604c', '422936'], // lospec.com/palette-list/gb-chocolate
						'kirby': ['f7bef7', 'e78686', '7733e7', '2c2c96'], // lospec.com/palette-list/kirby-sgb
						'sheep': ['f9fbf3', 'e4c179', 'bc7967', '292039'], // lospec.com/palette-list/sheepsheep
						'yoshi': ['e2f3e4', '94e344', '46878f', '332c50'], // lospec.com/palette-list/kirokaze-gameboy
						'mist': ['c4f0c2', '5ab9a8', '1e606e', '2d1b00'], // lospec.com/palette-list/mist-gb
						'starbug': ['8be5ff', '608fcf', '7550e8', '622e4c'] // lospec.com/palette-list/wish-gb
					};

					// Default settings
					gb.SetFPS (60); // 120 is performant but 60 is smoother
					gb.bootromEnabled = false;
					gb.SetPallete (this.palletes ['choco']);

					// Images
					const images = {};
						images.play = new Image ();
						images.play.src = 'img/button_play.png';

						images.pause = new Image ();
						images.pause.src = 'img/button_pause.png';

					// Status text
					var statTimeout = null;
					var statFadeMs = 1300;

					function SetStatMsg (msg) {
						nanaStat.innerHTML = msg;

						clearTimeout (statTimeout);
						statTimeout = setTimeout (ClearStatMsg, statFadeMs);
					}

					function ClearStatMsg () {
						nanaStat.innerHTML = '';
					}

					// Pause / play button
					function SetPauseImg (img) {
						nanaPause.style.backgroundImage = 'url(' + img.src + ')';
					}
					SetPauseImg (images.pause); // Default

					nanaPause.onclick = function () {
						if (!gb.cpu.hasRom)
							return;

						var paused = gb.TogglePause ();

						if (paused) {
							SetPauseImg (images.play);
							SetStatMsg ('paused !');
						}
						else {
							SetPauseImg (images.pause);
							SetStatMsg ('');
						}
					};

					// File reading
					function ReadRomFile (file) {
				        var fr = new FileReader ();

				        fr.onload = function () {
				        	var rom = new Uint8Array (fr.result);

				            try {
				            	gb.InsertRom (rom);
				            }
				            catch (e) {
				            	SetStatMsg (e);
				            }

				            gb.Start ();

				            SetPauseImg (images.pause);
				            //SetStatMsg ('rom loaded :)');
				        };

				        fr.readAsArrayBuffer (file);
					}

					nanaFin.onchange = function (evt) {
						var file = evt.target.files [0];
						if (!file)
							return;

						// Try removing the below to test no rom behavior !
						ReadRomFile (file);
					};

				//};
			</script>

		</div>

		<!-- Footer -->
		<div class='gbgap'></div>

		<div class='footwrap'>
			<p class='foottitle'>nectarboy | 2020 - 2021</p> <!-- â€¢ a spare bullet point for u -->

			<!-- Credits -->
			<a href='https://github.com/nectarboy/gameboy' class='hidehref'><p class='footsrc'>Source</p></a>
			<!-- Font: https://www.fontspace.com/super-legend-boy-font-f34010 -->
		</div>

	</body>

</html>